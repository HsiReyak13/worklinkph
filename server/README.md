# WorkLink PH Backend API

Backend server for WorkLink PH application built with Node.js, Express, and Supabase (PostgreSQL).

## Features

- ğŸ” Supabase Auth authentication
- ğŸ‘¤ User management (register, login, profile)
- ğŸ’¼ Job listings with search and filters
- ğŸ“š Resources directory
- ğŸ›¡ï¸ Security middleware (Helmet, CORS, Rate Limiting)
- âœ… Input validation
- ğŸ—„ï¸ Supabase (PostgreSQL) database

## Setup

### 1. Install Dependencies

```bash
cd server
npm install
```

### 2. Set Up Supabase

1. Create a Supabase project at https://supabase.com
2. Get your API keys from **Settings** â†’ **API**:
   - Project URL â†’ `SUPABASE_URL`
   - service_role key â†’ `SUPABASE_SERVICE_ROLE_KEY`
   - anon key â†’ `SUPABASE_ANON_KEY` (optional)

### 3. Configure Environment

Create a `.env` file in the `server` directory:

```env
PORT=5000
NODE_ENV=development
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
FRONTEND_URL=http://localhost:3000
```

### 4. Setup Database Schema

1. In Supabase dashboard, go to **SQL Editor**
2. Open `server/database/worklinkph.sql`
3. Copy and paste the entire SQL into the editor
4. Click **Run** to create all tables and indexes

ğŸ“– **See `SUPABASE_MIGRATION.md` for detailed migration instructions.**

### 5. Seed Sample Data (Optional)

The sample data is included in `worklinkph.sql`. If you want to seed more data, you can use the Supabase dashboard or create a custom script.

### 6. Start Server

**Development mode (with auto-reload):**
```bash
npm run dev
```

**Production mode:**
```bash
npm start
```

The server will run on `http://localhost:5000` (or your configured PORT).

## API Endpoints

### Authentication

- `POST /api/auth/register` - Register a new user
- `POST /api/auth/login` - Login user
- `POST /api/auth/forgot-password` - Request password reset
- `GET /api/auth/me` - Get current user (requires auth)

### Users

- `GET /api/users/profile` - Get user profile (requires auth)
- `PUT /api/users/profile` - Update user profile (requires auth)
- `DELETE /api/users/profile` - Delete user account (requires auth)

### Jobs

- `GET /api/jobs` - Get all jobs (with filters: search, type, location, tags)
- `GET /api/jobs/:id` - Get job by ID
- `POST /api/jobs` - Create a new job (requires auth)
- `PUT /api/jobs/:id` - Update a job (requires auth)
- `DELETE /api/jobs/:id` - Delete a job (requires auth)

### Resources

- `GET /api/resources` - Get all resources (with filters: search, type, category)
- `GET /api/resources/:id` - Get resource by ID
- `POST /api/resources` - Create a new resource (requires auth)
- `PUT /api/resources/:id` - Update a resource (requires auth)
- `DELETE /api/resources/:id` - Delete a resource (requires auth)

## Authentication

Protected routes require a Supabase Auth token in the Authorization header:

```
Authorization: Bearer <supabase_access_token>
```

Tokens are generated by Supabase Auth on login/register and automatically refreshed.

## Database Schema

### Users Table
- id, full_name, email, phone, password_hash
- city, province, identity, skills
- job_preferences (JSON), accessibility_settings (JSON), notification_preferences (JSON)
- created_at, updated_at

### Jobs Table
- id, title, company, location, description
- type, tags (JSON)
- posted_by (foreign key to users)
- created_at, updated_at

### Resources Table
- id, title, organization, category, description
- type, link, contact_info (JSON)
- created_at, updated_at

## Security Features

- **Helmet**: Security headers
- **CORS**: Cross-origin resource sharing configured
- **Rate Limiting**: Prevents abuse (100 requests per 15 minutes per IP)
- **Supabase Auth**: Industry-standard authentication with built-in features
- **Input Validation**: express-validator for request validation

## Development

### Scripts

- `npm start` - Start server
- `npm run dev` - Start server with nodemon (auto-reload)
- `npm run setup-db` - Initialize database tables
- `npm run seed` - Seed sample data

### Project Structure

```
server/
â”œâ”€â”€ config/          # Database configuration
â”œâ”€â”€ middleware/      # Express middleware
â”œâ”€â”€ models/         # Database models
â”œâ”€â”€ routes/         # API routes
â”œâ”€â”€ scripts/        # Database setup and seeding scripts
â”œâ”€â”€ .env.example    # Environment variables template
â”œâ”€â”€ .gitignore      # Git ignore rules
â”œâ”€â”€ package.json    # Dependencies
â””â”€â”€ server.js       # Main server file
```

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Server port | 5000 |
| `NODE_ENV` | Environment | development |
| `SUPABASE_URL` | Supabase project URL | (required) |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase service role key | (required) |
| `FRONTEND_URL` | Frontend URL for CORS | http://localhost:3000 |

## Notes

- Database is Supabase (PostgreSQL) with full-text search capabilities.
- Authentication uses Supabase Auth (no custom JWT or password hashing needed).
- All user passwords are handled securely by Supabase Auth.
- Rate limiting prevents API abuse.
- Supabase service role key bypasses RLS - only use on backend/server side.
- See `SUPABASE_MIGRATION.md` for database migration guide.
- See `SUPABASE_AUTH_MIGRATION.md` for authentication migration guide.

## License

ISC

